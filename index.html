<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LA MORENA SMOKESHOP - Premium & Exclusivo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #4c1d95 0%, #7c3aed 25%, #a855f7 50%, #22c55e 75%, #16a34a 100%);
        }
        
        .gradient-btn {
            background: linear-gradient(135deg, #7c3aed, #a855f7);
            transition: all 0.3s ease;
        }
        
        .gradient-btn:hover {
            background: linear-gradient(135deg, #6d28d9, #9333ea);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(124, 58, 237, 0.3);
        }
        
        .premium-card {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(168, 85, 247, 0.1));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(168, 85, 247, 0.2);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            margin: 2% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 95vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .cart-item {
            animation: cartItemAdd 0.3s ease-out;
        }
        
        @keyframes cartItemAdd {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .age-verification {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4c1d95, #7c3aed);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .floating-whatsapp {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: #25d366;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(37, 211, 102, 0.4);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .admin-panel {
            background: linear-gradient(135deg, #1f2937, #374151);
            color: white;
        }
        
        .emoji-picker {
            display: none;
            position: relative;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 10px;
            max-height: 150px;
            overflow-y: auto;
            z-index: 1001;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            margin-top: -4px;
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Verificaci√≥n de Edad -->
    <div id="ageVerification" class="age-verification">
        <div class="bg-white p-8 rounded-3xl shadow-2xl text-center max-w-md mx-4">
            <h2 class="text-3xl font-bold text-purple-800 mb-4">üîû Verificaci√≥n de Edad</h2>
            <p class="text-gray-600 mb-6">Debes ser mayor de edad para acceder a nuestro cat√°logo</p>
            <div class="space-y-4">
                <div class="grid grid-cols-3 gap-3">
                    <select id="birthDay" class="p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="">D√≠a</option>
                    </select>
                    <select id="birthMonth" class="p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="">Mes</option>
                    </select>
                    <select id="birthYear" class="p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="">A√±o</option>
                    </select>
                </div>
                <button onclick="verifyAge()" class="w-full gradient-btn text-white py-3 rounded-lg font-semibold">
                    Verificar Edad ‚ú®
                </button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="gradient-bg text-white shadow-2xl">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div id="logoContainer" class="w-16 h-16 bg-white rounded-full flex items-center justify-center">
                        <span class="text-2xl font-bold text-purple-800">LM</span>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold">LA MORENA SMOKESHOP</h1>
                        <p class="text-purple-200">Premium & Exclusivo üíé</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="openCart()" class="relative gradient-btn px-6 py-3 rounded-full font-semibold">
                        üõí Carrito (<span id="cartCount">0</span>)
                    </button>
                    <button onclick="openAdmin()" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded-lg text-sm">
                        Admin
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex space-x-8 overflow-x-auto py-4">
                <button onclick="showSection('home')" class="nav-btn whitespace-nowrap px-4 py-2 rounded-lg font-medium text-purple-800 hover:bg-purple-100">
                    üè† Inicio
                </button>
                <button onclick="showSection('catalog')" class="nav-btn whitespace-nowrap px-4 py-2 rounded-lg font-medium text-purple-800 hover:bg-purple-100">
                    üì± Cat√°logo
                </button>
                <button onclick="showSection('premium')" class="nav-btn whitespace-nowrap px-4 py-2 rounded-lg font-medium text-purple-800 hover:bg-purple-100">
                    üíé Premium
                </button>
                <button onclick="showSection('blog')" class="nav-btn whitespace-nowrap px-4 py-2 rounded-lg font-medium text-purple-800 hover:bg-purple-100">
                    üì∞ Blog
                </button>
                <button onclick="showSection('zona-rosa')" class="nav-btn whitespace-nowrap px-4 py-2 rounded-lg font-medium text-pink-600 hover:bg-pink-100">
                    üå∏ Zona Rosa
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Home Section -->
        <section id="homeSection" class="section">
            <div class="text-center mb-12">
                <h2 class="text-5xl font-bold text-purple-800 mb-4">Bienvenidos a LA MORENA üíú</h2>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                    Tu smokeshop premium de confianza. Productos exclusivos, calidad garantizada y la mejor experiencia de compra.
                </p>
            </div>
            
            <div class="category-grid mb-12">
                <div onclick="goToCategory('papeles')" class="premium-card p-6 rounded-2xl text-center hover:transform hover:scale-105 transition-all duration-300 cursor-pointer hover:shadow-xl">
                    <div class="text-4xl mb-4">üìú</div>
                    <h3 class="text-xl font-bold text-purple-800 mb-2">Papeles & Wraps</h3>
                    <p class="text-gray-600 mb-4">La mejor selecci√≥n de papeles premium</p>
                    <div class="gradient-btn text-white py-2 px-4 rounded-lg font-semibold inline-block">
                        Ver Productos ‚Üí
                    </div>
                </div>
                <div onclick="goToCategory('encendedores')" class="premium-card p-6 rounded-2xl text-center hover:transform hover:scale-105 transition-all duration-300 cursor-pointer hover:shadow-xl">
                    <div class="text-4xl mb-4">üî•</div>
                    <h3 class="text-xl font-bold text-purple-800 mb-2">Encendedores</h3>
                    <p class="text-gray-600 mb-4">Encendedores de alta calidad</p>
                    <div class="gradient-btn text-white py-2 px-4 rounded-lg font-semibold inline-block">
                        Ver Productos ‚Üí
                    </div>
                </div>
                <div onclick="goToCategory('grinders')" class="premium-card p-6 rounded-2xl text-center hover:transform hover:scale-105 transition-all duration-300 cursor-pointer hover:shadow-xl">
                    <div class="text-4xl mb-4">üåø</div>
                    <h3 class="text-xl font-bold text-purple-800 mb-2">Grinders & Pipas</h3>
                    <p class="text-gray-600 mb-4">Accesorios profesionales</p>
                    <div class="gradient-btn text-white py-2 px-4 rounded-lg font-semibold inline-block">
                        Ver Productos ‚Üí
                    </div>
                </div>
                <div onclick="goToCategory('electronicos')" class="premium-card p-6 rounded-2xl text-center hover:transform hover:scale-105 transition-all duration-300 cursor-pointer hover:shadow-xl">
                    <div class="text-4xl mb-4">üí®</div>
                    <h3 class="text-xl font-bold text-purple-800 mb-2">Vapes & Electr√≥nicos</h3>
                    <p class="text-gray-600 mb-4">Tecnolog√≠a de vanguardia</p>
                    <div class="gradient-btn text-white py-2 px-4 rounded-lg font-semibold inline-block">
                        Ver Productos ‚Üí
                    </div>
                </div>
            </div>
        </section>

        <!-- Catalog Section -->
        <section id="catalogSection" class="section hidden">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-4xl font-bold text-purple-800">Cat√°logo Digital üì±</h2>
                <div class="flex space-x-4">
                    <select id="categoryFilter" onchange="filterProducts()" class="p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="">Todas las categor√≠as</option>
                        <!-- Las categor√≠as se cargar√°n din√°micamente -->
                    </select>
                </div>
            </div>
            
            <div id="productsGrid" class="product-grid">
                <!-- Los productos se cargar√°n din√°micamente -->
            </div>
        </section>

        <!-- Premium Section -->
        <section id="premiumSection" class="section hidden">
            <div class="text-center mb-12">
                <h2 class="text-5xl font-bold text-purple-800 mb-4">Colecci√≥n Premium üíé</h2>
                <p class="text-xl text-gray-600">Productos exclusivos para los m√°s exigentes</p>
            </div>
            <div id="premiumProducts" class="product-grid">
                <!-- Productos premium se cargar√°n aqu√≠ -->
            </div>
        </section>

        <!-- Blog Section -->
        <section id="blogSection" class="section hidden">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-4xl font-bold text-purple-800">Blog & Noticias üì∞</h2>
            </div>
            <div id="blogPosts" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Posts del blog se cargar√°n aqu√≠ -->
            </div>
        </section>

        <!-- Zona Rosa Section -->
        <section id="zonaRosaSection" class="section hidden">
            <div class="text-center mb-12">
                <h2 class="text-5xl font-bold text-pink-600 mb-4">Zona Rosa üå∏</h2>
                <p class="text-xl text-gray-600">Productos especiales con toque femenino</p>
            </div>
            <div id="zonaRosaProducts" class="product-grid">
                <!-- Productos zona rosa se cargar√°n aqu√≠ -->
            </div>
        </section>
    </main>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-purple-800">üõí Tu Carrito</h3>
                <button onclick="closeCart()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <div id="cartItems" class="space-y-4 mb-6 max-h-60 overflow-y-auto">
                <!-- Items del carrito -->
            </div>
            <div class="border-t pt-4">
                <div class="flex justify-between items-center text-xl font-bold text-purple-800 mb-4">
                    <span>Total:</span>
                    <span id="cartTotal">$0</span>
                </div>
                <div class="space-y-3">
                    <select id="paymentMethod" class="w-full p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="">Seleccionar m√©todo de pago</option>
                        <!-- Los m√©todos de pago se cargar√°n din√°micamente -->
                    </select>
                    <button onclick="proceedToCheckout()" class="w-full gradient-btn text-white py-3 rounded-lg font-semibold">
                        Proceder al Checkout ‚ú®
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-purple-800">üìã Datos de Entrega</h3>
                <button onclick="closeCheckout()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="checkoutForm" class="space-y-4">
                <input type="text" id="customerName" placeholder="Nombre completo" class="w-full p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                <input type="text" id="customerAddress" placeholder="Direcci√≥n completa" class="w-full p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                <input type="text" id="customerNeighborhood" placeholder="Barrio" class="w-full p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                <input type="tel" id="customerPhone" placeholder="Tel√©fono" class="w-full p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                <input type="email" id="customerEmail" placeholder="Correo electr√≥nico" class="w-full p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                <div class="flex space-x-3">
                    <button type="submit" class="flex-1 gradient-btn text-white py-3 rounded-lg font-semibold">
                        Confirmar Pedido ‚úÖ
                    </button>
                    <button type="button" onclick="sendToWhatsApp()" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-semibold">
                        WhatsApp üì±
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="modal">
        <div class="modal-content admin-panel max-w-6xl max-h-95vh overflow-y-auto">
            <div class="flex justify-between items-center mb-6 sticky top-0 bg-gradient-to-r from-gray-800 to-gray-700 z-10 p-4 -m-4 mb-2 rounded-t-lg">
                <h3 class="text-2xl font-bold text-white">‚öôÔ∏è Panel de Administraci√≥n</h3>
                <button onclick="closeAdmin()" class="text-gray-300 hover:text-white text-2xl">&times;</button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-6">
                <button onclick="showAdminSection('products')" class="admin-nav-btn bg-purple-600 hover:bg-purple-700 px-4 py-3 rounded-lg font-semibold">
                    üì¶ Productos
                </button>
                <button onclick="showAdminSection('categories')" class="admin-nav-btn bg-purple-600 hover:bg-purple-700 px-4 py-3 rounded-lg font-semibold">
                    üìÇ Categor√≠as
                </button>
                <button onclick="showAdminSection('blog')" class="admin-nav-btn bg-purple-600 hover:bg-purple-700 px-4 py-3 rounded-lg font-semibold">
                    üì∞ Blog
                </button>
                <button onclick="showAdminSection('customers')" class="admin-nav-btn bg-purple-600 hover:bg-purple-700 px-4 py-3 rounded-lg font-semibold">
                    üë• Clientes
                </button>
                <button onclick="showAdminSection('payments')" class="admin-nav-btn bg-purple-600 hover:bg-purple-700 px-4 py-3 rounded-lg font-semibold">
                    üí≥ Pagos
                </button>
                <button onclick="showAdminSection('settings')" class="admin-nav-btn bg-purple-600 hover:bg-purple-700 px-4 py-3 rounded-lg font-semibold">
                    ‚öôÔ∏è Configuraci√≥n
                </button>
            </div>

            <!-- Admin Products Section -->
            <div id="adminProducts" class="admin-section">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-xl font-bold">Gesti√≥n de Productos</h4>
                    <button onclick="showAddProduct()" class="gradient-btn px-4 py-2 rounded-lg">
                        ‚ûï Agregar Producto
                    </button>
                </div>
                <div id="adminProductsList" class="space-y-4 max-h-96 overflow-y-auto">
                    <!-- Lista de productos para admin -->
                </div>
            </div>

            <!-- Admin Categories Section -->
            <div id="adminCategories" class="admin-section hidden">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-xl font-bold">Gesti√≥n de Categor√≠as</h4>
                    <button onclick="showAddCategory()" class="gradient-btn px-4 py-2 rounded-lg">
                        ‚ûï Agregar Categor√≠a
                    </button>
                </div>
                <div id="adminCategoriesList" class="space-y-4">
                    <!-- Lista de categor√≠as -->
                </div>
            </div>

            <!-- Admin Blog Section -->
            <div id="adminBlog" class="admin-section hidden">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-xl font-bold">Gesti√≥n de Blog</h4>
                    <button onclick="showAddBlogPost()" class="gradient-btn px-4 py-2 rounded-lg">
                        ‚ûï Nuevo Post
                    </button>
                </div>
                <div id="adminBlogList" class="space-y-4">
                    <!-- Lista de posts -->
                </div>
            </div>

            <!-- Admin Customers Section -->
            <div id="adminCustomers" class="admin-section hidden">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-xl font-bold">Base de Datos de Clientes</h4>
                    <button onclick="downloadCustomersData()" class="gradient-btn px-4 py-2 rounded-lg">
                        üì• Descargar Datos
                    </button>
                </div>
                <div id="adminCustomersList" class="space-y-4 max-h-96 overflow-y-auto">
                    <!-- Lista de clientes -->
                </div>
            </div>

            <!-- Admin Payments Section -->
            <div id="adminPayments" class="admin-section hidden">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-xl font-bold">Gesti√≥n de M√©todos de Pago</h4>
                    <button onclick="showAddPaymentMethod()" class="gradient-btn px-4 py-2 rounded-lg">
                        ‚ûï Agregar M√©todo
                    </button>
                </div>
                <div id="adminPaymentsList" class="space-y-4 max-h-96 overflow-y-auto">
                    <!-- Lista de m√©todos de pago -->
                </div>
            </div>

            <!-- Admin Settings Section -->
            <div id="adminSettings" class="admin-section hidden">
                <div class="space-y-6">
                    <div>
                        <h4 class="text-xl font-bold mb-4">Configuraci√≥n del Logo</h4>
                        <div class="bg-gray-700 p-6 rounded-lg space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="text-lg font-semibold mb-3">Logo del Header</h5>
                                    <div class="space-y-3">
                                        <input type="file" id="headerLogoFile" accept="image/*" class="w-full p-3 border border-gray-500 rounded-lg bg-gray-600 text-white">
                                        <button onclick="uploadHeaderLogo()" class="w-full gradient-btn px-4 py-2 rounded-lg">
                                            üì§ Subir Logo Header
                                        </button>
                                        <div id="headerLogoPreview" class="hidden">
                                            <img id="headerLogoImg" src="" alt="Vista previa" class="w-16 h-16 object-contain rounded-lg mx-auto">
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h5 class="text-lg font-semibold mb-3">Logo de Fondo</h5>
                                    <div class="space-y-3">
                                        <input type="file" id="backgroundLogoFile" accept="image/*" class="w-full p-3 border border-gray-500 rounded-lg bg-gray-600 text-white">
                                        <div class="space-y-2">
                                            <label class="block text-sm font-medium">Opacidad del fondo:</label>
                                            <input type="range" id="backgroundOpacity" min="0.1" max="0.8" step="0.1" value="0.3" class="w-full">
                                            <span id="opacityValue" class="text-sm text-gray-300">30%</span>
                                        </div>
                                        <button onclick="uploadBackgroundLogo()" class="w-full gradient-btn px-4 py-2 rounded-lg">
                                            üñºÔ∏è Subir Logo Fondo
                                        </button>
                                        <button onclick="removeBackgroundLogo()" class="w-full bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg">
                                            üóëÔ∏è Quitar Fondo
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="text-xl font-bold mb-4">Informaci√≥n de Contacto</h4>
                        <div class="bg-gray-700 p-6 rounded-lg space-y-4">
                            <input type="tel" id="whatsappNumber" placeholder="N√∫mero de WhatsApp (ej: 573150646191)" class="w-full p-3 border border-gray-500 rounded-lg bg-gray-600 text-white" value="573150646191">
                            <input type="email" id="businessEmail" placeholder="Email del negocio" class="w-full p-3 border border-gray-500 rounded-lg bg-gray-600 text-white">
                            <textarea id="businessAddress" placeholder="Direcci√≥n del negocio" class="w-full p-3 border border-gray-500 rounded-lg bg-gray-600 text-white h-20"></textarea>
                            <button onclick="saveContactInfo()" class="gradient-btn px-4 py-2 rounded-lg">
                                üíæ Guardar Informaci√≥n
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="modal-content max-w-2xl">
            <div class="flex justify-between items-center mb-6 sticky top-0 bg-white z-10 pb-4 border-b -mx-8 px-8 -mt-8 pt-8 rounded-t-lg">
                <h3 class="text-2xl font-bold text-purple-800">‚ûï Agregar Producto</h3>
                <button onclick="closeAddProduct()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="addProductForm" class="space-y-4 pb-4">
                <input type="text" id="productName" placeholder="Nombre del producto" class="w-full p-3 border border-purple-300 rounded-lg" required>
                <input type="number" id="productPrice" placeholder="Precio" class="w-full p-3 border border-purple-300 rounded-lg" required>
                <select id="productCategory" class="w-full p-3 border border-purple-300 rounded-lg" required>
                    <option value="">Seleccionar categor√≠a</option>
                    <!-- Las categor√≠as se cargar√°n din√°micamente -->
                </select>
                <textarea id="productDescription" placeholder="Descripci√≥n del producto" class="w-full p-3 border border-purple-300 rounded-lg h-24"></textarea>
                <div class="flex space-x-4">
                    <input type="file" id="productImage" accept="image/*" class="flex-1 p-3 border border-purple-300 rounded-lg">
                    <button type="button" onclick="showEmojiPicker('productEmoji')" class="px-4 py-3 border border-purple-300 rounded-lg">üòä</button>
                </div>
                <input type="text" id="productEmoji" placeholder="Emoji del producto" class="w-full p-3 border border-purple-300 rounded-lg">
                <div class="emoji-picker" id="emojiPicker" style="position: relative; z-index: 1001;"></div>
                <button type="submit" class="w-full gradient-btn text-white py-3 rounded-lg font-semibold">
                    Agregar Producto ‚ú®
                </button>
            </form>
        </div>
    </div>

    <!-- Add Blog Post Modal -->
    <div id="addBlogModal" class="modal">
        <div class="modal-content max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6 sticky top-0 bg-white z-10 pb-4 border-b">
                <h3 class="text-2xl font-bold text-purple-800">üìù Nuevo Post</h3>
                <button onclick="closeAddBlog()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="addBlogForm" class="space-y-6">
                <input type="text" id="blogTitle" placeholder="T√≠tulo del post" class="w-full p-3 border border-purple-300 rounded-lg" required>
                <select id="blogType" class="w-full p-3 border border-purple-300 rounded-lg" required>
                    <option value="">Tipo de contenido</option>
                    <option value="blog">Blog</option>
                    <option value="noticia">Noticia</option>
                    <option value="evento">Evento</option>
                    <option value="tendencia">Tendencia</option>
                </select>
                <textarea id="blogContent" placeholder="Contenido del post (puedes usar saltos de l√≠nea para p√°rrafos)" class="w-full p-3 border border-purple-300 rounded-lg h-40"></textarea>
                
                <div class="space-y-4">
                    <h4 class="text-lg font-semibold text-purple-800">Imagen Principal</h4>
                    <input type="file" id="blogImage" accept="image/*" class="w-full p-3 border border-purple-300 rounded-lg">
                    <div id="blogImagePreview" class="hidden">
                        <img id="blogImagePreviewImg" src="" alt="Vista previa" class="w-full h-48 object-cover rounded-lg">
                    </div>
                </div>

                <div class="space-y-4">
                    <h4 class="text-lg font-semibold text-purple-800">Video Principal</h4>
                    <input type="file" id="blogVideo" accept="video/*" class="w-full p-3 border border-purple-300 rounded-lg">
                    <div id="blogVideoPreview" class="hidden">
                        <video id="blogVideoPreviewVid" src="" controls class="w-full h-48 rounded-lg"></video>
                    </div>
                </div>

                <div class="space-y-4">
                    <h4 class="text-lg font-semibold text-purple-800">Galer√≠a de Im√°genes Adicionales</h4>
                    <input type="file" id="blogGallery" accept="image/*" multiple class="w-full p-3 border border-purple-300 rounded-lg">
                    <div id="galleryPreview" class="grid grid-cols-3 gap-4 hidden">
                        <!-- Vista previa de galer√≠a -->
                    </div>
                </div>

                <div class="space-y-4">
                    <h4 class="text-lg font-semibold text-purple-800">Videos Adicionales</h4>
                    <input type="file" id="blogVideos" accept="video/*" multiple class="w-full p-3 border border-purple-300 rounded-lg">
                    <div id="videosPreview" class="space-y-4 hidden">
                        <!-- Vista previa de videos -->
                    </div>
                </div>

                <button type="submit" class="w-full gradient-btn text-white py-3 rounded-lg font-semibold">
                    Publicar Post ‚ú®
                </button>
            </form>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-purple-800">üîê Acceso Administrativo</h3>
                <button onclick="closeAdminLogin()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="adminLoginForm" class="space-y-4">
                <input type="password" id="adminPassword" placeholder="Contrase√±a de administrador" class="w-full p-3 border border-purple-300 rounded-lg" required>
                <button type="submit" class="w-full gradient-btn text-white py-3 rounded-lg font-semibold">
                    Ingresar ‚ú®
                </button>
            </form>
        </div>
    </div>

    <!-- Add Payment Method Modal -->
    <div id="addPaymentModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-purple-800">üí≥ Agregar M√©todo de Pago</h3>
                <button onclick="closeAddPayment()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="addPaymentForm" class="space-y-4">
                <input type="text" id="paymentName" placeholder="Nombre del m√©todo (ej: Nequi)" class="w-full p-3 border border-purple-300 rounded-lg" required>
                <div class="flex space-x-4">
                    <input type="text" id="paymentEmoji" placeholder="Emoji" class="w-20 p-3 border border-purple-300 rounded-lg text-center">
                    <button type="button" onclick="showEmojiPicker('paymentEmoji')" class="px-4 py-3 border border-purple-300 rounded-lg">üòä</button>
                </div>
                <textarea id="paymentDescription" placeholder="Descripci√≥n del m√©todo de pago" class="w-full p-3 border border-purple-300 rounded-lg h-20"></textarea>
                <input type="text" id="paymentAccount" placeholder="N√∫mero de cuenta o informaci√≥n adicional (opcional)" class="w-full p-3 border border-purple-300 rounded-lg">
                <button type="submit" class="w-full gradient-btn text-white py-3 rounded-lg font-semibold">
                    Agregar M√©todo ‚ú®
                </button>
            </form>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div id="addCategoryModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-purple-800">üìÇ Agregar Categor√≠a</h3>
                <button onclick="closeAddCategory()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="addCategoryForm" class="space-y-4">
                <input type="text" id="categoryName" placeholder="Nombre de la categor√≠a" class="w-full p-3 border border-purple-300 rounded-lg" required>
                <input type="text" id="categoryKey" placeholder="Clave de la categor√≠a (ej: papeles)" class="w-full p-3 border border-purple-300 rounded-lg" required>
                <div class="flex space-x-4">
                    <input type="text" id="categoryEmoji" placeholder="Emoji" class="w-20 p-3 border border-purple-300 rounded-lg text-center">
                    <button type="button" onclick="showEmojiPicker('categoryEmoji')" class="px-4 py-3 border border-purple-300 rounded-lg">üòä</button>
                </div>
                <textarea id="categoryDescription" placeholder="Descripci√≥n de la categor√≠a" class="w-full p-3 border border-purple-300 rounded-lg h-24"></textarea>
                <button type="submit" class="w-full gradient-btn text-white py-3 rounded-lg font-semibold">
                    Agregar Categor√≠a ‚ú®
                </button>
            </form>
        </div>
    </div>

    <!-- Blog Detail Modal -->
    <div id="blogDetailModal" class="modal">
        <div class="modal-content max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6 sticky top-0 bg-white z-10 pb-4 border-b">
                <h3 class="text-2xl font-bold text-purple-800">üì∞ Detalle del Post</h3>
                <button onclick="closeBlogDetail()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <div id="blogDetailContent">
                <!-- Contenido del blog se carga aqu√≠ -->
            </div>
        </div>
    </div>

    <!-- Product Details Modal -->
    <div id="productDetailsModal" class="modal">
        <div class="modal-content max-w-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-purple-800">üìã Detalles del Producto</h3>
                <button onclick="closeProductDetails()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <div id="productDetailsContent">
                <!-- Contenido del producto se carga aqu√≠ -->
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="relative max-w-4xl max-h-[90vh]">
                <button onclick="closeImageModal()" class="absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full w-10 h-10 flex items-center justify-center text-2xl z-10">&times;</button>
                <img id="modalImage" src="" alt="Imagen ampliada" class="max-w-full max-h-[90vh] object-contain rounded-lg">
            </div>
        </div>
    </div>

    <!-- Floating WhatsApp Button -->
    <a href="https://wa.me/573150646191" target="_blank" class="floating-whatsapp">
        <svg width="30" height="30" fill="white" viewBox="0 0 24 24">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
        </svg>
    </a>

    <script>
        // Variables globales
        let cart = [];
        let products = [];
        let customers = [];
        let blogPosts = [];
        let paymentMethods = [];
        let categories = [];
        let isAdminLoggedIn = false;
        let currentSection = 'home';

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            initializeAgeVerification();
            loadSampleData();
            loadPaymentMethods();
            updateCategorySelectors();
            showSection('home');
            
            // Inicializar slider de opacidad
            const opacitySlider = document.getElementById('backgroundOpacity');
            const opacityValue = document.getElementById('opacityValue');
            if (opacitySlider && opacityValue) {
                opacitySlider.addEventListener('input', function() {
                    opacityValue.textContent = Math.round(this.value * 100) + '%';
                });
            }
        });

        // Verificaci√≥n de edad
        function initializeAgeVerification() {
            const daySelect = document.getElementById('birthDay');
            const monthSelect = document.getElementById('birthMonth');
            const yearSelect = document.getElementById('birthYear');

            // Llenar d√≠as
            for (let i = 1; i <= 31; i++) {
                daySelect.innerHTML += `<option value="${i}">${i}</option>`;
            }

            // Llenar meses
            const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                           'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            months.forEach((month, index) => {
                monthSelect.innerHTML += `<option value="${index + 1}">${month}</option>`;
            });

            // Llenar a√±os
            const currentYear = new Date().getFullYear();
            for (let i = currentYear; i >= currentYear - 100; i--) {
                yearSelect.innerHTML += `<option value="${i}">${i}</option>`;
            }
        }

        function verifyAge() {
            const day = parseInt(document.getElementById('birthDay').value);
            const month = parseInt(document.getElementById('birthMonth').value);
            const year = parseInt(document.getElementById('birthYear').value);

            if (!day || !month || !year) {
                alert('Por favor completa todos los campos de fecha');
                return;
            }

            const birthDate = new Date(year, month - 1, day);
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();

            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }

            if (age >= 18) {
                document.getElementById('ageVerification').style.display = 'none';
            } else {
                alert('Debes ser mayor de edad para acceder a este sitio');
            }
        }

        // Navegaci√≥n
        function showSection(sectionName) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });

            // Mostrar la secci√≥n seleccionada
            document.getElementById(sectionName + 'Section').classList.remove('hidden');
            currentSection = sectionName;

            // Actualizar navegaci√≥n
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-purple-100', 'bg-pink-100');
            });

            // Cargar contenido espec√≠fico
            if (sectionName === 'catalog') {
                loadProducts();
            } else if (sectionName === 'premium') {
                loadPremiumProducts();
            } else if (sectionName === 'blog') {
                loadBlogPosts();
            } else if (sectionName === 'zona-rosa') {
                loadZonaRosaProducts();
            }
        }

        // Cargar datos de muestra
        function loadSampleData() {
            products = [
                {
                    id: 1,
                    name: 'Papel RAW Classic',
                    price: 15000,
                    category: 'papeles',
                    description: 'Papeles RAW Classic fabricados con fibras naturales no refinadas.\n\nCaracter√≠sticas principales:\n‚Ä¢ Combusti√≥n lenta y uniforme\n‚Ä¢ Sin blanqueadores qu√≠micos\n‚Ä¢ Papel ultra fino de 13 GSM\n‚Ä¢ Goma natural de acacia\n‚Ä¢ Tama√±o King Size\n‚Ä¢ 32 hojas por librito\n\nLos papeles RAW son reconocidos mundialmente por su calidad superior y su compromiso con ingredientes naturales. Perfectos para una experiencia de fumado pura y aut√©ntica.',
                    emoji: 'üìú',
                    image: null,
                    visible: true
                },
                {
                    id: 2,
                    name: 'Encendedor Clipper',
                    price: 25000,
                    category: 'encendedores',
                    description: 'Encendedor Clipper original recargable con dise√±o ic√≥nico.\n\nCaracter√≠sticas:\n‚Ä¢ Recargable con gas butano\n‚Ä¢ Piedra reemplazable\n‚Ä¢ V√°lvula de seguridad redonda\n‚Ä¢ Llama ajustable\n‚Ä¢ Dise√±o ergon√≥mico\n‚Ä¢ M√∫ltiples colores disponibles\n\nLos encendedores Clipper son famosos por su durabilidad y funcionalidad. Su dise√±o √∫nico permite usarlo como herramienta para compactar, convirti√©ndolo en el compa√±ero perfecto para cualquier fumador.',
                    emoji: 'üî•',
                    image: null,
                    visible: true
                },
                {
                    id: 3,
                    name: 'Grinder Met√°lico Premium',
                    price: 45000,
                    category: 'grinders',
                    description: 'Grinder de aleaci√≥n de zinc de 4 piezas con sistema magn√©tico.\n\nEspecificaciones:\n‚Ä¢ Material: Aleaci√≥n de zinc de alta calidad\n‚Ä¢ 4 piezas con separaci√≥n magn√©tica\n‚Ä¢ Dientes afilados de corte diamantado\n‚Ä¢ Malla fina para polen\n‚Ä¢ Di√°metro: 63mm\n‚Ä¢ Incluye raspador\n\nDise√±o profesional que garantiza un molido uniforme y eficiente. La construcci√≥n robusta asegura a√±os de uso confiable, mientras que el sistema magn√©tico mantiene todas las piezas perfectamente alineadas.',
                    emoji: '‚öôÔ∏è',
                    image: null,
                    visible: true
                },
                {
                    id: 4,
                    name: 'Vape Pen Deluxe',
                    price: 120000,
                    category: 'electronicos',
                    description: 'Vaporizador port√°til de √∫ltima generaci√≥n con control de temperatura.\n\nCaracter√≠sticas t√©cnicas:\n‚Ä¢ Bater√≠a de 2200mAh de larga duraci√≥n\n‚Ä¢ Control de temperatura variable (180¬∞C - 220¬∞C)\n‚Ä¢ C√°mara de cer√°mica pura\n‚Ä¢ Calentamiento en 30 segundos\n‚Ä¢ Pantalla LED digital\n‚Ä¢ Carga USB-C r√°pida\n‚Ä¢ Apagado autom√°tico de seguridad\n\nTecnolog√≠a avanzada que ofrece vaporizaciones limpias y sabrosas. El control preciso de temperatura permite extraer los mejores sabores y efectos, mientras que la bater√≠a de alta capacidad garantiza sesiones prolongadas.',
                    emoji: 'üí®',
                    image: null,
                    visible: true
                },
                {
                    id: 5,
                    name: 'Bong Cristal Rosa',
                    price: 85000,
                    category: 'zona-rosa',
                    description: 'Bong de cristal borosilicato con elegantes detalles en rosa.\n\nCaracter√≠sticas especiales:\n‚Ä¢ Cristal borosilicato de alta calidad\n‚Ä¢ Detalles decorativos en rosa\n‚Ä¢ Altura: 25cm\n‚Ä¢ Base estable y amplia\n‚Ä¢ Tubo difusor incluido\n‚Ä¢ F√°cil limpieza\n‚Ä¢ Dise√±o femenino y elegante\n\nCombina funcionalidad superior con un dise√±o hermoso y femenino. El cristal borosilicato garantiza durabilidad y pureza en cada uso, mientras que los detalles rosados a√±aden un toque de elegancia √∫nico.',
                    emoji: 'üå∏',
                    image: null,
                    visible: true
                },
                {
                    id: 6,
                    name: 'Set Premium Gold',
                    price: 250000,
                    category: 'premium',
                    description: 'Set completo de lujo con acabados dorados y estuche premium.\n\nIncluye:\n‚Ä¢ Grinder dorado de 4 piezas (63mm)\n‚Ä¢ Bandeja de rolling dorada\n‚Ä¢ Encendedor Clipper edici√≥n oro\n‚Ä¢ Papeles RAW Black King Size (5 libritos)\n‚Ä¢ Tips de cart√≥n premium\n‚Ä¢ Herramientas de acero inoxidable\n‚Ä¢ Estuche de cuero sint√©tico\n\nColecci√≥n exclusiva para los m√°s exigentes. Cada pieza ha sido seleccionada por su calidad excepcional y dise√±o elegante. Los acabados dorados y el estuche premium hacen de este set el regalo perfecto o la adici√≥n ideal para cualquier colecci√≥n.',
                    emoji: 'üíé',
                    image: null,
                    visible: true
                }
            ];

            blogPosts = [
                {
                    id: 1,
                    title: 'Nuevas Tendencias en Vaping 2024',
                    type: 'tendencia',
                    content: 'Descubre las √∫ltimas innovaciones en el mundo del vapeo.\n\nEste a√±o ha tra√≠do consigo incre√≠bles avances tecnol√≥gicos que est√°n revolucionando la experiencia de vapeo. Desde dispositivos m√°s eficientes hasta nuevos sabores y tecnolog√≠as de calentamiento.\n\nLas principales tendencias incluyen:\n‚Ä¢ Dispositivos con mayor duraci√≥n de bater√≠a\n‚Ä¢ Sistemas de control de temperatura m√°s precisos\n‚Ä¢ Nuevos materiales m√°s seguros y duraderos\n‚Ä¢ Dise√±os m√°s ergon√≥micos y port√°tiles\n\n¬°Mantente al d√≠a con todas las novedades en LA MORENA SMOKESHOP!',
                    image: null,
                    video: null,
                    gallery: [],
                    videos: [],
                    date: new Date().toLocaleDateString()
                },
                {
                    id: 2,
                    title: 'Evento Especial - Descuentos de Temporada',
                    type: 'evento',
                    content: 'No te pierdas nuestros descuentos especiales este mes.\n\nüéâ GRAN PROMOCI√ìN DE TEMPORADA üéâ\n\nEstamos celebrando con incre√≠bles descuentos en toda nuestra colecci√≥n premium. Esta es tu oportunidad de conseguir los mejores productos a precios √∫nicos.\n\nOfertas destacadas:\n‚Ä¢ 20% de descuento en toda la l√≠nea de vapes\n‚Ä¢ 2x1 en papeles seleccionados\n‚Ä¢ Descuentos especiales en grinders premium\n‚Ä¢ Env√≠o gratis en compras superiores a $100.000\n\nLa promoci√≥n es v√°lida hasta fin de mes. ¬°No dejes pasar esta oportunidad!',
                    image: null,
                    video: null,
                    gallery: [],
                    videos: [],
                    date: new Date().toLocaleDateString()
                }
            ];

            paymentMethods = [
                { id: 1, name: 'Efectivo', emoji: 'üíµ', description: 'Pago en efectivo contra entrega', active: true },
                { id: 2, name: 'Transferencia Bancaria', emoji: 'üè¶', description: 'Transferencia a cuenta bancaria', active: true },
                { id: 3, name: 'Link Dat√°fono Bold', emoji: 'üí≥', description: 'Pago con tarjeta a trav√©s de Bold', active: true },
                { id: 4, name: 'Nequi', emoji: 'üì±', description: 'Pago a trav√©s de Nequi', active: true },
                { id: 5, name: 'Daviplata', emoji: 'üí∞', description: 'Pago a trav√©s de Daviplata', active: true }
            ];

            categories = [
                { key: 'papeles', name: 'Papeles, Cueros, Wraps y Tabaco', emoji: 'üìú', description: 'Papeles de fumar, wraps, cueros y tabaco premium' },
                { key: 'encendedores', name: 'Encendedores', emoji: 'üî•', description: 'Encendedores de alta calidad y dise√±os √∫nicos' },
                { key: 'pipas', name: 'Pipas', emoji: 'üö¨', description: 'Pipas artesanales y de colecci√≥n' },
                { key: 'grinders', name: 'Grinders', emoji: '‚öôÔ∏è', description: 'Molinos y grinders de diferentes materiales' },
                { key: 'bongs', name: 'Bongs', emoji: 'üåä', description: 'Bongs de cristal y materiales premium' },
                { key: 'bandejas', name: 'Bandejas', emoji: 'üìã', description: 'Bandejas para rolling y organizaci√≥n' },
                { key: 'electronicos', name: 'Dispositivos Electr√≥nicos y Vapes', emoji: 'üí®', description: 'Vaporizadores y dispositivos electr√≥nicos' },
                { key: 'vidrio', name: 'Vidrio', emoji: 'üîÆ', description: 'Productos de vidrio artesanal' },
                { key: 'premium', name: 'Premium', emoji: 'üíé', description: 'Productos exclusivos de lujo' },
                { key: 'zona-rosa', name: 'Zona Rosa', emoji: 'üå∏', description: 'Productos con dise√±o femenino y elegante' }
            ];
        }

        // Productos
        function loadProducts() {
            const grid = document.getElementById('productsGrid');
            const categoryFilter = document.getElementById('categoryFilter').value;
            
            let filteredProducts = products.filter(product => 
                product.visible && (categoryFilter === '' || product.category === categoryFilter)
            );

            grid.innerHTML = filteredProducts.map(product => `
                <div class="premium-card p-6 rounded-2xl hover:transform hover:scale-105 transition-all duration-300">
                    <div class="text-center mb-4">
                        ${product.image ? 
                            `<img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover rounded-lg mb-4">` :
                            `<div class="text-6xl mb-4">${product.emoji}</div>`
                        }
                        <h3 class="text-xl font-bold text-purple-800 mb-4">${product.name}</h3>
                        <div class="text-2xl font-bold text-green-600 mb-4">
                            $${product.price.toLocaleString('es-CO')}
                        </div>
                        <div class="space-y-2">
                            <button onclick="viewProductDetails(${product.id})" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-2 rounded-lg font-semibold transition-all duration-200">
                                Ver Detalles üëÅÔ∏è
                            </button>
                            <button onclick="addToCart(${product.id})" class="w-full gradient-btn text-white py-3 rounded-lg font-semibold hover:transform hover:scale-105 transition-all duration-200">
                                Agregar al Carrito üõí
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadPremiumProducts() {
            const grid = document.getElementById('premiumProducts');
            const premiumProducts = products.filter(product => product.category === 'premium' && product.visible);
            
            grid.innerHTML = premiumProducts.map(product => `
                <div class="premium-card p-6 rounded-2xl hover:transform hover:scale-105 transition-all duration-300 border-2 border-yellow-400">
                    <div class="text-center mb-4">
                        ${product.image ? 
                            `<img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover rounded-lg mb-4">` :
                            `<div class="text-6xl mb-4">${product.emoji}</div>`
                        }
                        <div class="flex items-center justify-center mb-4">
                            <span class="text-yellow-500 text-2xl">üëë</span>
                            <h3 class="text-xl font-bold text-purple-800 mx-2">${product.name}</h3>
                            <span class="text-yellow-500 text-2xl">üëë</span>
                        </div>
                        <div class="text-2xl font-bold text-green-600 mb-4">
                            $${product.price.toLocaleString('es-CO')}
                        </div>
                        <div class="space-y-2">
                            <button onclick="viewProductDetails(${product.id})" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-2 rounded-lg font-semibold transition-all duration-200">
                                Ver Detalles üëÅÔ∏è
                            </button>
                            <button onclick="addToCart(${product.id})" class="w-full gradient-btn text-white py-3 rounded-lg font-semibold hover:transform hover:scale-105 transition-all duration-200">
                                Agregar al Carrito üõí
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadZonaRosaProducts() {
            const grid = document.getElementById('zonaRosaProducts');
            const zonaRosaProducts = products.filter(product => product.category === 'zona-rosa' && product.visible);
            
            grid.innerHTML = zonaRosaProducts.map(product => `
                <div class="premium-card p-6 rounded-2xl hover:transform hover:scale-105 transition-all duration-300 border-2 border-pink-400">
                    <div class="text-center mb-4">
                        ${product.image ? 
                            `<img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover rounded-lg mb-4">` :
                            `<div class="text-6xl mb-4">${product.emoji}</div>`
                        }
                        <div class="flex items-center justify-center mb-4">
                            <span class="text-pink-500 text-2xl">üå∏</span>
                            <h3 class="text-xl font-bold text-pink-600 mx-2">${product.name}</h3>
                            <span class="text-pink-500 text-2xl">üå∏</span>
                        </div>
                        <div class="text-2xl font-bold text-green-600 mb-4">
                            $${product.price.toLocaleString('es-CO')}
                        </div>
                        <div class="space-y-2">
                            <button onclick="viewProductDetails(${product.id})" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-2 rounded-lg font-semibold transition-all duration-200">
                                Ver Detalles üëÅÔ∏è
                            </button>
                            <button onclick="addToCart(${product.id})" class="w-full bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white py-3 rounded-lg font-semibold hover:transform hover:scale-105 transition-all duration-200">
                                Agregar al Carrito üõí
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filterProducts() {
            loadProducts();
        }

        // Carrito
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                const existingItem = cart.find(item => item.id === productId);
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({...product, quantity: 1});
                }
                updateCartCount();
                
                // Animaci√≥n de confirmaci√≥n
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '‚úÖ Agregado';
                button.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.background = '';
                }, 1000);
            }
        }

        function updateCartCount() {
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            document.getElementById('cartCount').textContent = count;
        }

        function openCart() {
            const modal = document.getElementById('cartModal');
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="text-center text-gray-500 py-8">Tu carrito est√° vac√≠o üõí</p>';
                cartTotal.textContent = '$0';
            } else {
                cartItems.innerHTML = cart.map(item => `
                    <div class="cart-item flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-4">
                            <div class="text-2xl">${item.emoji}</div>
                            <div>
                                <h4 class="font-semibold text-purple-800">${item.name}</h4>
                                <p class="text-gray-600">$${item.price.toLocaleString('es-CO')} c/u</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <button onclick="updateQuantity(${item.id}, -1)" class="w-8 h-8 bg-red-500 text-white rounded-full hover:bg-red-600">-</button>
                            <span class="font-semibold">${item.quantity}</span>
                            <button onclick="updateQuantity(${item.id}, 1)" class="w-8 h-8 bg-green-500 text-white rounded-full hover:bg-green-600">+</button>
                            <button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-700 ml-2">üóëÔ∏è</button>
                        </div>
                    </div>
                `).join('');
                
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                cartTotal.textContent = `$${total.toLocaleString('es-CO')}`;
            }
            
            modal.style.display = 'block';
        }

        function closeCart() {
            document.getElementById('cartModal').style.display = 'none';
        }

        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    openCart(); // Refresh cart display
                    updateCartCount();
                }
            }
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            openCart(); // Refresh cart display
            updateCartCount();
        }

        function proceedToCheckout() {
            if (cart.length === 0) {
                alert('Tu carrito est√° vac√≠o');
                return;
            }
            
            const paymentMethod = document.getElementById('paymentMethod').value;
            if (!paymentMethod) {
                alert('Por favor selecciona un m√©todo de pago');
                return;
            }
            
            closeCart();
            document.getElementById('checkoutModal').style.display = 'block';
        }

        function closeCheckout() {
            document.getElementById('checkoutModal').style.display = 'none';
        }

        function sendToWhatsApp() {
            const form = document.getElementById('checkoutForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const customerData = {
                name: document.getElementById('customerName').value,
                address: document.getElementById('customerAddress').value,
                neighborhood: document.getElementById('customerNeighborhood').value,
                phone: document.getElementById('customerPhone').value,
                email: document.getElementById('customerEmail').value,
                paymentMethod: document.getElementById('paymentMethod').value,
                items: cart,
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                date: new Date().toLocaleString()
            };

            // Guardar cliente en base de datos
            customers.push(customerData);

            // Crear mensaje para WhatsApp
            let message = `üõí *NUEVO PEDIDO - LA MORENA SMOKESHOP*\n\n`;
            message += `üë§ *Cliente:* ${customerData.name}\n`;
            message += `üìç *Direcci√≥n:* ${customerData.address}, ${customerData.neighborhood}\n`;
            message += `üì± *Tel√©fono:* ${customerData.phone}\n`;
            message += `üìß *Email:* ${customerData.email}\n`;
            message += `üí≥ *M√©todo de pago:* ${customerData.paymentMethod}\n\n`;
            message += `üõçÔ∏è *PRODUCTOS:*\n`;
            
            cart.forEach(item => {
                message += `‚Ä¢ ${item.name} x${item.quantity} - $${(item.price * item.quantity).toLocaleString('es-CO')}\n`;
            });
            
            message += `\nüí∞ *TOTAL: $${customerData.total.toLocaleString('es-CO')}*\n\n`;
            message += `üìÖ *Fecha:* ${customerData.date}`;

            const whatsappUrl = `https://wa.me/573150646191?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');

            // Limpiar carrito y cerrar modal
            cart = [];
            updateCartCount();
            closeCheckout();
            alert('¬°Pedido enviado! Te contactaremos pronto üòä');
        }

        // Checkout form submission
        document.getElementById('checkoutForm').addEventListener('submit', function(e) {
            e.preventDefault();
            sendToWhatsApp();
        });

        // Blog
        function loadBlogPosts() {
            const grid = document.getElementById('blogPosts');
            
            grid.innerHTML = blogPosts.map(post => `
                <div class="premium-card p-6 rounded-2xl hover:transform hover:scale-105 transition-all duration-300 cursor-pointer" onclick="openBlogDetail(${post.id})">
                    ${post.image ? `<img src="${post.image}" alt="${post.title}" class="w-full h-48 object-cover rounded-lg mb-4">` : ''}
                    ${post.video ? `<video src="${post.video}" class="w-full h-48 rounded-lg mb-4" muted></video>` : ''}
                    <div class="flex items-center justify-between mb-3">
                        <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium">
                            ${post.type.charAt(0).toUpperCase() + post.type.slice(1)}
                        </span>
                        <span class="text-gray-500 text-sm">${post.date}</span>
                    </div>
                    <h3 class="text-xl font-bold text-purple-800 mb-3">${post.title}</h3>
                    <p class="text-gray-600 line-clamp-3">${post.content.substring(0, 150)}${post.content.length > 150 ? '...' : ''}</p>
                    <div class="mt-4 text-purple-600 font-semibold hover:text-purple-800">
                        Leer m√°s ‚Üí
                    </div>
                </div>
            `).join('');
        }

        function openBlogDetail(postId) {
            const post = blogPosts.find(p => p.id === postId);
            if (!post) return;

            const modal = document.getElementById('blogDetailModal');
            const content = document.getElementById('blogDetailContent');
            
            content.innerHTML = `
                <div class="mb-6">
                    ${post.image ? `<img src="${post.image}" alt="${post.title}" class="w-full h-64 object-cover rounded-lg mb-4">` : ''}
                    ${post.video ? `<video src="${post.video}" controls class="w-full h-64 rounded-lg mb-4"></video>` : ''}
                    <div class="flex items-center justify-between mb-4">
                        <span class="px-4 py-2 bg-purple-100 text-purple-800 rounded-full font-medium">
                            ${post.type.charAt(0).toUpperCase() + post.type.slice(1)}
                        </span>
                        <span class="text-gray-500">${post.date}</span>
                    </div>
                    <h2 class="text-3xl font-bold text-purple-800 mb-4">${post.title}</h2>
                    <div class="text-gray-700 leading-relaxed whitespace-pre-line">${post.content}</div>
                    ${post.gallery && post.gallery.length > 0 ? `
                        <div class="mt-6">
                            <h4 class="text-lg font-semibold text-purple-800 mb-3">Galer√≠a de Im√°genes</h4>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                ${post.gallery.map(img => `
                                    <img src="${img}" alt="Galer√≠a" class="w-full h-32 object-cover rounded-lg cursor-pointer hover:opacity-80" onclick="openImageModal('${img}')">
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    ${post.videos && post.videos.length > 0 ? `
                        <div class="mt-6">
                            <h4 class="text-lg font-semibold text-purple-800 mb-3">Videos</h4>
                            <div class="space-y-4">
                                ${post.videos.map(video => `
                                    <video src="${video}" controls class="w-full rounded-lg"></video>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function closeBlogDetail() {
            document.getElementById('blogDetailModal').style.display = 'none';
        }

        function openImageModal(imageSrc) {
            const modal = document.getElementById('imageModal');
            const img = document.getElementById('modalImage');
            img.src = imageSrc;
            modal.style.display = 'block';
        }

        function closeImageModal() {
            document.getElementById('imageModal').style.display = 'none';
        }

        // Product Details Functions
        function viewProductDetails(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const modal = document.getElementById('productDetailsModal');
            const content = document.getElementById('productDetailsContent');
            
            content.innerHTML = `
                <div class="space-y-6">
                    <div class="text-center">
                        ${product.image ? 
                            `<img src="${product.image}" alt="${product.name}" class="w-full max-w-md mx-auto h-64 object-cover rounded-lg mb-4 cursor-pointer" onclick="openImageModal('${product.image}')">` :
                            `<div class="text-8xl mb-4">${product.emoji}</div>`
                        }
                        <div class="flex items-center justify-center mb-4">
                            ${product.category === 'premium' ? 
                                `<span class="text-yellow-500 text-2xl">üëë</span>
                                <h2 class="text-2xl font-bold text-purple-800 mx-2">${product.name}</h2>
                                <span class="text-yellow-500 text-2xl">üëë</span>` :
                                product.category === 'zona-rosa' ?
                                `<span class="text-pink-500 text-2xl">üå∏</span>
                                <h2 class="text-2xl font-bold text-pink-600 mx-2">${product.name}</h2>
                                <span class="text-pink-500 text-2xl">üå∏</span>` :
                                `<h2 class="text-2xl font-bold text-purple-800">${product.name}</h2>`
                            }
                        </div>
                        <div class="text-3xl font-bold text-green-600 mb-4">
                            $${product.price.toLocaleString('es-CO')}
                        </div>
                        <div class="inline-block px-4 py-2 bg-purple-100 text-purple-800 rounded-full font-medium mb-4">
                            Categor√≠a: ${getCategoryName(product.category)}
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h3 class="text-lg font-bold text-purple-800 mb-3">üìù Descripci√≥n Detallada</h3>
                        <p class="text-gray-700 leading-relaxed whitespace-pre-line">${product.description}</p>
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg">
                        <h3 class="text-lg font-bold text-purple-800 mb-3">‚ú® Caracter√≠sticas</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div class="flex items-center space-x-2">
                                <span class="text-green-500">‚úÖ</span>
                                <span>Producto original y aut√©ntico</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-green-500">‚úÖ</span>
                                <span>Calidad premium garantizada</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-green-500">‚úÖ</span>
                                <span>Env√≠o seguro y discreto</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-green-500">‚úÖ</span>
                                <span>Atenci√≥n personalizada</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="addToCart(${product.id}); closeProductDetails();" class="flex-1 gradient-btn text-white py-3 rounded-lg font-semibold hover:transform hover:scale-105 transition-all duration-200">
                            üõí Agregar al Carrito
                        </button>
                        <button onclick="shareProduct(${product.id})" class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold transition-all duration-200">
                            üì± Compartir
                        </button>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function closeProductDetails() {
            document.getElementById('productDetailsModal').style.display = 'none';
        }

        function getCategoryName(categoryKey) {
            const categories = {
                'papeles': 'Papeles, Cueros, Wraps y Tabaco',
                'encendedores': 'Encendedores',
                'pipas': 'Pipas',
                'grinders': 'Grinders',
                'bongs': 'Bongs',
                'bandejas': 'Bandejas',
                'electronicos': 'Dispositivos Electr√≥nicos y Vapes',
                'vidrio': 'Vidrio',
                'premium': 'Premium',
                'zona-rosa': 'Zona Rosa'
            };
            return categories[categoryKey] || categoryKey;
        }

        function shareProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const message = `üõçÔ∏è *${product.name}* - LA MORENA SMOKESHOP\n\n` +
                          `üí∞ Precio: $${product.price.toLocaleString('es-CO')}\n` +
                          `üìù ${product.description.substring(0, 200)}${product.description.length > 200 ? '...' : ''}\n\n` +
                          `¬°Pregunta por este producto! üíú`;

            const whatsappUrl = `https://wa.me/573150646191?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            
            // Mostrar confirmaci√≥n visual
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '‚úÖ Compartido';
            button.style.background = '#10b981';
            setTimeout(() => {
                button.innerHTML = originalText;
                button.style.background = '';
            }, 2000);
        }

        // Admin Panel
        function openAdmin() {
            document.getElementById('adminLoginModal').style.display = 'block';
        }

        function closeAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'none';
            // Limpiar el campo de contrase√±a por seguridad
            document.getElementById('adminPassword').value = '';
        }

        document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('adminPassword').value;
            
            if (password === 'Lamorena04191106') {
                isAdminLoggedIn = true;
                // Limpiar contrase√±a inmediatamente por seguridad
                document.getElementById('adminPassword').value = '';
                closeAdminLogin();
                document.getElementById('adminPanel').style.display = 'block';
                showAdminSection('products');
            } else {
                alert('Contrase√±a incorrecta');
                // Limpiar contrase√±a tambi√©n si es incorrecta
                document.getElementById('adminPassword').value = '';
            }
        });

        function closeAdmin() {
            document.getElementById('adminPanel').style.display = 'none';
            isAdminLoggedIn = false;
            // Limpiar el campo de contrase√±a por seguridad
            document.getElementById('adminPassword').value = '';
        }

        function showAdminSection(section) {
            // Ocultar todas las secciones admin
            document.querySelectorAll('.admin-section').forEach(sec => {
                sec.classList.add('hidden');
            });
            
            // Mostrar la secci√≥n seleccionada
            document.getElementById('admin' + section.charAt(0).toUpperCase() + section.slice(1)).classList.remove('hidden');
            
            // Actualizar botones de navegaci√≥n
            document.querySelectorAll('.admin-nav-btn').forEach(btn => {
                btn.classList.remove('bg-purple-800');
                btn.classList.add('bg-purple-600');
            });
            event.target.classList.remove('bg-purple-600');
            event.target.classList.add('bg-purple-800');
            
            // Cargar contenido espec√≠fico
            if (section === 'products') {
                loadAdminProducts();
            } else if (section === 'categories') {
                loadAdminCategories();
            } else if (section === 'customers') {
                loadAdminCustomers();
            } else if (section === 'blog') {
                loadAdminBlog();
            } else if (section === 'payments') {
                loadAdminPayments();
            } else if (section === 'settings') {
                loadAdminSettings();
            }
        }

        function loadAdminProducts() {
            const list = document.getElementById('adminProductsList');
            
            list.innerHTML = products.map(product => `
                <div class="bg-gray-700 p-4 rounded-lg flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="text-2xl">${product.emoji}</div>
                        <div>
                            <h4 class="font-semibold">${product.name}</h4>
                            <p class="text-gray-300">$${product.price.toLocaleString('es-CO')} - ${product.category}</p>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editProduct(${product.id})" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm">‚úèÔ∏è Editar</button>
                        <button onclick="toggleProductVisibility(${product.id})" class="px-3 py-1 ${product.visible ? 'bg-yellow-600 hover:bg-yellow-700' : 'bg-green-600 hover:bg-green-700'} rounded text-sm">
                            ${product.visible ? 'üëÅÔ∏è Ocultar' : 'üëÅÔ∏è‚Äçüó®Ô∏è Mostrar'}
                        </button>
                        <button onclick="deleteProduct(${product.id})" class="px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm">üóëÔ∏è Eliminar</button>
                    </div>
                </div>
            `).join('');
        }

        function loadAdminCustomers() {
            const list = document.getElementById('adminCustomersList');
            
            if (customers.length === 0) {
                list.innerHTML = '<p class="text-center text-gray-400 py-8">No hay clientes registrados a√∫n</p>';
                return;
            }
            
            list.innerHTML = customers.map((customer, index) => `
                <div class="bg-gray-700 p-4 rounded-lg">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold">${customer.name}</h4>
                        <span class="text-gray-400 text-sm">${customer.date}</span>
                    </div>
                    <p class="text-gray-300 text-sm">üìç ${customer.address}, ${customer.neighborhood}</p>
                    <p class="text-gray-300 text-sm">üì± ${customer.phone} | üìß ${customer.email}</p>
                    <p class="text-gray-300 text-sm">üí≥ ${customer.paymentMethod}</p>
                    <p class="text-green-400 font-semibold">üí∞ Total: $${customer.total.toLocaleString('es-CO')}</p>
                </div>
            `).join('');
        }

        function loadAdminBlog() {
            const list = document.getElementById('adminBlogList');
            
            list.innerHTML = blogPosts.map(post => `
                <div class="bg-gray-700 p-4 rounded-lg flex items-center justify-between">
                    <div>
                        <h4 class="font-semibold">${post.title}</h4>
                        <p class="text-gray-300 text-sm">${post.type} - ${post.date}</p>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editBlogPost(${post.id})" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm">‚úèÔ∏è Editar</button>
                        <button onclick="deleteBlogPost(${post.id})" class="px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm">üóëÔ∏è Eliminar</button>
                    </div>
                </div>
            `).join('');
        }

        function showAddProduct() {
            document.getElementById('addProductModal').style.display = 'block';
        }

        function closeAddProduct() {
            document.getElementById('addProductModal').style.display = 'none';
            document.getElementById('addProductForm').reset();
            
            // Reset form to add mode
            delete document.getElementById('addProductForm').dataset.editingId;
            document.querySelector('#addProductModal h3').textContent = '‚ûï Agregar Producto';
            document.querySelector('#addProductForm button[type="submit"]').textContent = 'Agregar Producto ‚ú®';
        }

        function showAddBlogPost() {
            document.getElementById('addBlogModal').style.display = 'block';
        }

        function closeAddBlog() {
            document.getElementById('addBlogModal').style.display = 'none';
            document.getElementById('addBlogForm').reset();
            
            // Reset form to add mode
            delete document.getElementById('addBlogForm').dataset.editingId;
            document.querySelector('#addBlogModal h3').textContent = 'üìù Nuevo Post';
            document.querySelector('#addBlogForm button[type="submit"]').textContent = 'Publicar Post ‚ú®';
            
            // Reset previews
            document.getElementById('blogImagePreview').classList.add('hidden');
            document.getElementById('blogVideoPreview').classList.add('hidden');
            document.getElementById('galleryPreview').classList.add('hidden');
            document.getElementById('videosPreview').classList.add('hidden');
        }

        // Preview functions for blog form
        document.getElementById('blogImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('blogImagePreviewImg').src = e.target.result;
                    document.getElementById('blogImagePreview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('blogVideo').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('blogVideoPreviewVid').src = e.target.result;
                    document.getElementById('blogVideoPreview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('blogGallery').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            const preview = document.getElementById('galleryPreview');
            
            if (files.length > 0) {
                preview.innerHTML = '';
                files.forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'w-full h-24 object-cover rounded-lg';
                        img.alt = `Galer√≠a ${index + 1}`;
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                });
                preview.classList.remove('hidden');
            }
        });

        document.getElementById('blogVideos').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            const preview = document.getElementById('videosPreview');
            
            if (files.length > 0) {
                preview.innerHTML = '';
                files.forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const video = document.createElement('video');
                        video.src = e.target.result;
                        video.className = 'w-full h-32 rounded-lg';
                        video.controls = true;
                        preview.appendChild(video);
                    };
                    reader.readAsDataURL(file);
                });
                preview.classList.remove('hidden');
            }
        });

        // Form submissions
        document.getElementById('addProductForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const editingId = this.dataset.editingId;
            const isEditing = !!editingId;
            
            const productData = {
                id: isEditing ? parseInt(editingId) : Date.now(),
                name: document.getElementById('productName').value,
                price: parseInt(document.getElementById('productPrice').value),
                category: document.getElementById('productCategory').value,
                description: document.getElementById('productDescription').value,
                emoji: document.getElementById('productEmoji').value || 'üì¶',
                image: null,
                visible: true
            };
            
            // Handle image upload
            const imageFile = document.getElementById('productImage').files[0];
            
            function saveProduct() {
                if (isEditing) {
                    const index = products.findIndex(p => p.id === parseInt(editingId));
                    if (index !== -1) {
                        // Keep existing image if no new image uploaded
                        if (!imageFile) {
                            productData.image = products[index].image;
                        }
                        products[index] = productData;
                    }
                } else {
                    products.push(productData);
                }
                
                // Reset form
                delete document.getElementById('addProductForm').dataset.editingId;
                document.querySelector('#addProductModal h3').textContent = '‚ûï Agregar Producto';
                document.querySelector('#addProductForm button[type="submit"]').textContent = 'Agregar Producto ‚ú®';
                
                closeAddProduct();
                loadAdminProducts();
                refreshCurrentSection();
            }
            
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    productData.image = e.target.result;
                    saveProduct();
                };
                reader.readAsDataURL(imageFile);
            } else {
                saveProduct();
            }
        });

        document.getElementById('addBlogForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const editingId = this.dataset.editingId;
            const isEditing = !!editingId;
            
            const postData = {
                id: isEditing ? parseInt(editingId) : Date.now(),
                title: document.getElementById('blogTitle').value,
                type: document.getElementById('blogType').value,
                content: document.getElementById('blogContent').value,
                image: null,
                video: null,
                gallery: [],
                videos: [],
                date: isEditing ? blogPosts.find(p => p.id === parseInt(editingId))?.date : new Date().toLocaleDateString()
            };
            
            // If editing, preserve existing media if no new files uploaded
            if (isEditing) {
                const existingPost = blogPosts.find(p => p.id === parseInt(editingId));
                if (existingPost) {
                    postData.image = existingPost.image;
                    postData.video = existingPost.video;
                    postData.gallery = [...existingPost.gallery];
                    postData.videos = [...existingPost.videos];
                }
            }
            
            // Handle all file uploads
            const imageFile = document.getElementById('blogImage').files[0];
            const videoFile = document.getElementById('blogVideo').files[0];
            const galleryFiles = Array.from(document.getElementById('blogGallery').files);
            const videoFiles = Array.from(document.getElementById('blogVideos').files);
            
            let filesProcessed = 0;
            const totalFiles = (imageFile ? 1 : 0) + (videoFile ? 1 : 0) + galleryFiles.length + videoFiles.length;
            
            function checkComplete() {
                filesProcessed++;
                if (filesProcessed === totalFiles || totalFiles === 0) {
                    if (isEditing) {
                        const index = blogPosts.findIndex(p => p.id === parseInt(editingId));
                        if (index !== -1) {
                            blogPosts[index] = postData;
                        }
                    } else {
                        blogPosts.push(postData);
                    }
                    
                    // Reset form
                    delete document.getElementById('addBlogForm').dataset.editingId;
                    document.querySelector('#addBlogModal h3').textContent = 'üìù Nuevo Post';
                    document.querySelector('#addBlogForm button[type="submit"]').textContent = 'Publicar Post ‚ú®';
                    
                    closeAddBlog();
                    loadAdminBlog();
                    if (currentSection === 'blog') {
                        loadBlogPosts();
                    }
                }
            }
            
            // Process main image
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    postData.image = e.target.result;
                    checkComplete();
                };
                reader.readAsDataURL(imageFile);
            }
            
            // Process main video
            if (videoFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    postData.video = e.target.result;
                    checkComplete();
                };
                reader.readAsDataURL(videoFile);
            }
            
            // Process gallery images (replace existing if new files uploaded)
            if (galleryFiles.length > 0) {
                postData.gallery = []; // Clear existing gallery
                galleryFiles.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        postData.gallery.push(e.target.result);
                        checkComplete();
                    };
                    reader.readAsDataURL(file);
                });
            }
            
            // Process additional videos (replace existing if new files uploaded)
            if (videoFiles.length > 0) {
                postData.videos = []; // Clear existing videos
                videoFiles.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        postData.videos.push(e.target.result);
                        checkComplete();
                    };
                    reader.readAsDataURL(file);
                });
            }
            
            if (totalFiles === 0) {
                checkComplete();
            }
        });

        // Product management functions
        function toggleProductVisibility(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                product.visible = !product.visible;
                loadAdminProducts();
                refreshCurrentSection();
            }
        }

        // Confirmation modal functions
        function showConfirmModal(title, message, onConfirm) {
            // Remove any existing confirmation modals
            closeConfirmModal();
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'confirmationModal';
            modal.style.display = 'block';
            modal.style.zIndex = '9999999';
            modal.style.backgroundColor = 'rgba(0,0,0,0.95)';
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.innerHTML = `
                <div class="modal-content max-w-md" style="margin: 15vh auto; box-shadow: 0 25px 50px rgba(0,0,0,0.8); border: 3px solid #ef4444; background: white; position: relative; z-index: 10000000;">
                    <div class="text-center mb-6">
                        <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                        <h3 class="text-2xl font-bold text-red-600 mb-4">${title}</h3>
                        <p class="text-gray-700 mb-6 text-lg leading-relaxed">${message}</p>
                    </div>
                    <div class="flex space-x-4">
                        <button onclick="closeConfirmModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-6 rounded-lg font-semibold text-lg transition-all duration-200 transform hover:scale-105">
                            ‚ùå Cancelar
                        </button>
                        <button onclick="confirmAction()" class="flex-1 bg-red-500 hover:bg-red-600 text-white py-3 px-6 rounded-lg font-semibold text-lg transition-all duration-200 transform hover:scale-105">
                            ‚úÖ Confirmar
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Store the confirmation action
            window.confirmAction = function() {
                onConfirm();
                closeConfirmModal();
            };
            
            // Prevent background scrolling
            document.body.style.overflow = 'hidden';
            
            // Focus on the modal and bring to front
            modal.focus();
            modal.scrollIntoView();
        }

        function closeConfirmModal() {
            const existingModal = document.getElementById('confirmationModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Restore background scrolling
            document.body.style.overflow = '';
            
            // Clean up the global function
            if (window.confirmAction) {
                delete window.confirmAction;
            }
        }

        // Product management functions
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            // Fill form with existing data
            document.getElementById('productName').value = product.name;
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productCategory').value = product.category;
            document.getElementById('productDescription').value = product.description;
            document.getElementById('productEmoji').value = product.emoji;
            
            // Change form title and button
            document.querySelector('#addProductModal h3').textContent = '‚úèÔ∏è Editar Producto';
            document.querySelector('#addProductForm button[type="submit"]').textContent = 'Actualizar Producto ‚ú®';
            
            // Store editing product ID
            document.getElementById('addProductForm').dataset.editingId = productId;
            
            document.getElementById('addProductModal').style.display = 'block';
        }

        function deleteProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            showConfirmModal(
                'üóëÔ∏è Eliminar Producto',
                `¬øEst√°s seguro de que quieres eliminar "${product.name}"? Esta acci√≥n no se puede deshacer.`,
                function() {
                    products = products.filter(p => p.id !== productId);
                    loadAdminProducts();
                    refreshCurrentSection();
                }
            );
        }

        // Blog management functions
        function editBlogPost(postId) {
            const post = blogPosts.find(p => p.id === postId);
            if (!post) return;
            
            // Fill form with existing data
            document.getElementById('blogTitle').value = post.title;
            document.getElementById('blogType').value = post.type;
            document.getElementById('blogContent').value = post.content;
            
            // Show existing media previews
            if (post.image) {
                document.getElementById('blogImagePreviewImg').src = post.image;
                document.getElementById('blogImagePreview').classList.remove('hidden');
            }
            
            if (post.video) {
                document.getElementById('blogVideoPreviewVid').src = post.video;
                document.getElementById('blogVideoPreview').classList.remove('hidden');
            }
            
            if (post.gallery && post.gallery.length > 0) {
                const preview = document.getElementById('galleryPreview');
                preview.innerHTML = post.gallery.map(img => `
                    <img src="${img}" alt="Galer√≠a" class="w-full h-24 object-cover rounded-lg">
                `).join('');
                preview.classList.remove('hidden');
            }
            
            if (post.videos && post.videos.length > 0) {
                const preview = document.getElementById('videosPreview');
                preview.innerHTML = post.videos.map(video => `
                    <video src="${video}" controls class="w-full h-32 rounded-lg"></video>
                `).join('');
                preview.classList.remove('hidden');
            }
            
            // Change form title and button
            document.querySelector('#addBlogModal h3').textContent = '‚úèÔ∏è Editar Post';
            document.querySelector('#addBlogForm button[type="submit"]').textContent = 'Actualizar Post ‚ú®';
            
            // Store editing post ID
            document.getElementById('addBlogForm').dataset.editingId = postId;
            
            document.getElementById('addBlogModal').style.display = 'block';
        }

        function deleteBlogPost(postId) {
            const post = blogPosts.find(p => p.id === postId);
            if (!post) return;
            
            showConfirmModal(
                'üóëÔ∏è Eliminar Post',
                `¬øEst√°s seguro de que quieres eliminar "${post.title}"? Esta acci√≥n no se puede deshacer.`,
                function() {
                    blogPosts = blogPosts.filter(p => p.id !== postId);
                    loadAdminBlog();
                    if (currentSection === 'blog') {
                        loadBlogPosts();
                    }
                }
            );
        }

        // Category management functions
        function loadAdminCategories() {
            const list = document.getElementById('adminCategoriesList');
            
            list.innerHTML = categories.map(category => `
                <div class="bg-gray-700 p-4 rounded-lg flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="text-2xl">${category.emoji}</div>
                        <div>
                            <h4 class="font-semibold">${category.name}</h4>
                            <p class="text-gray-300 text-sm">Clave: ${category.key}</p>
                            <p class="text-gray-400 text-xs">${category.description}</p>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editCategory('${category.key}')" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm">‚úèÔ∏è Editar</button>
                        <button onclick="deleteCategory('${category.key}')" class="px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm">üóëÔ∏è Eliminar</button>
                    </div>
                </div>
            `).join('');
        }

        function showAddCategory() {
            document.getElementById('addCategoryModal').style.display = 'block';
        }

        function closeAddCategory() {
            document.getElementById('addCategoryModal').style.display = 'none';
            document.getElementById('addCategoryForm').reset();
            
            // Reset form to add mode
            delete document.getElementById('addCategoryForm').dataset.editingKey;
            document.querySelector('#addCategoryModal h3').textContent = 'üìÇ Agregar Categor√≠a';
            document.querySelector('#addCategoryForm button[type="submit"]').textContent = 'Agregar Categor√≠a ‚ú®';
        }

        function editCategory(categoryKey) {
            const category = categories.find(c => c.key === categoryKey);
            if (!category) return;
            
            // Fill form with existing data
            document.getElementById('categoryName').value = category.name;
            document.getElementById('categoryKey').value = category.key;
            document.getElementById('categoryEmoji').value = category.emoji;
            document.getElementById('categoryDescription').value = category.description;
            
            // Change form title and button
            document.querySelector('#addCategoryModal h3').textContent = '‚úèÔ∏è Editar Categor√≠a';
            document.querySelector('#addCategoryForm button[type="submit"]').textContent = 'Actualizar Categor√≠a ‚ú®';
            
            // Store editing category key
            document.getElementById('addCategoryForm').dataset.editingKey = categoryKey;
            
            document.getElementById('addCategoryModal').style.display = 'block';
        }

        function deleteCategory(categoryKey) {
            const category = categories.find(c => c.key === categoryKey);
            if (!category) return;
            
            // Check if category has products
            const hasProducts = products.some(p => p.category === categoryKey);
            if (hasProducts) {
                showConfirmModal(
                    '‚ö†Ô∏è Categor√≠a en Uso',
                    `No puedes eliminar "${category.name}" porque tiene productos asociados. Primero elimina o cambia la categor√≠a de los productos.`,
                    function() {
                        // Just close the modal, no action needed
                    }
                );
                return;
            }
            
            showConfirmModal(
                'üóëÔ∏è Eliminar Categor√≠a',
                `¬øEst√°s seguro de que quieres eliminar "${category.name}"? Esta acci√≥n no se puede deshacer.`,
                function() {
                    categories = categories.filter(c => c.key !== categoryKey);
                    loadAdminCategories();
                    updateCategorySelectors();
                }
            );
        }

        function updateCategorySelectors() {
            // Update product form category selector
            const productCategorySelect = document.getElementById('productCategory');
            if (productCategorySelect) {
                const currentValue = productCategorySelect.value;
                productCategorySelect.innerHTML = '<option value="">Seleccionar categor√≠a</option>';
                categories.forEach(category => {
                    productCategorySelect.innerHTML += `<option value="${category.key}">${category.name}</option>`;
                });
                productCategorySelect.value = currentValue;
            }
            
            // Update catalog filter
            const categoryFilter = document.getElementById('categoryFilter');
            if (categoryFilter) {
                const currentValue = categoryFilter.value;
                categoryFilter.innerHTML = '<option value="">Todas las categor√≠as</option>';
                categories.forEach(category => {
                    categoryFilter.innerHTML += `<option value="${category.key}">${category.name}</option>`;
                });
                categoryFilter.value = currentValue;
            }
        }

        function downloadCustomersData() {
            if (customers.length === 0) {
                alert('No hay datos de clientes para descargar');
                return;
            }
            
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Nombre,Direcci√≥n,Barrio,Tel√©fono,Email,M√©todo de Pago,Total,Fecha\n"
                + customers.map(customer => 
                    `"${customer.name}","${customer.address}","${customer.neighborhood}","${customer.phone}","${customer.email}","${customer.paymentMethod}","$${customer.total.toLocaleString('es-CO')}","${customer.date}"`
                ).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `clientes_lamorena_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function refreshCurrentSection() {
            if (currentSection === 'catalog') {
                loadProducts();
            } else if (currentSection === 'premium') {
                loadPremiumProducts();
            } else if (currentSection === 'zona-rosa') {
                loadZonaRosaProducts();
            }
        }

        // Funci√≥n para navegar a una categor√≠a espec√≠fica
        function goToCategory(category) {
            // Cambiar a la secci√≥n del cat√°logo
            showSection('catalog');
            
            // Seleccionar la categor√≠a en el filtro
            document.getElementById('categoryFilter').value = category;
            
            // Filtrar los productos
            filterProducts();
            
            // Scroll suave hacia el cat√°logo
            document.getElementById('catalogSection').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
            
            // Efecto visual para mostrar que se filtr√≥
            const grid = document.getElementById('productsGrid');
            grid.style.opacity = '0.5';
            setTimeout(() => {
                grid.style.opacity = '1';
                grid.style.transition = 'opacity 0.5s ease';
            }, 200);
        }

        // Emoji picker
        function showEmojiPicker(targetInputId) {
            const picker = document.getElementById('emojiPicker');
            const emojis = ['üòä', 'üî•', 'üí®', 'üåø', 'üìú', '‚öôÔ∏è', 'üíé', 'üå∏', 'üéØ', '‚ú®', 'üöÄ', 'üíú', 'üñ§', 'üíö', 'ü§ç', 'üíñ', 'üîÆ', 'üåü', '‚≠ê', 'üí´'];
            
            picker.innerHTML = emojis.map(emoji => 
                `<button type="button" onclick="selectEmoji('${emoji}', '${targetInputId}')" class="p-2 hover:bg-gray-100 rounded">${emoji}</button>`
            ).join('');
            
            picker.style.display = picker.style.display === 'block' ? 'none' : 'block';
        }

        function selectEmoji(emoji, targetInputId) {
            document.getElementById(targetInputId).value = emoji;
            document.getElementById('emojiPicker').style.display = 'none';
        }

        // Logo management
        function openLogoModal() {
            document.getElementById('logoModal').style.display = 'block';
        }

        function closeLogoModal() {
            document.getElementById('logoModal').style.display = 'none';
        }

        document.getElementById('logoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const logoFile = document.getElementById('logoFile').files[0];
            const position = document.querySelector('input[name="logoPosition"]:checked').value;
            
            if (logoFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const logoUrl = e.target.result;
                    
                    if (position === 'header') {
                        document.getElementById('logoContainer').innerHTML = `<img src="${logoUrl}" alt="LA MORENA SMOKESHOP" class="w-full h-full object-contain rounded-full">`;
                    } else {
                        document.body.style.backgroundImage = `url(${logoUrl})`;
                        document.body.style.backgroundSize = 'cover';
                        document.body.style.backgroundPosition = 'center';
                        document.body.style.backgroundAttachment = 'fixed';
                        document.body.style.backgroundRepeat = 'no-repeat';
                    }
                    
                    closeLogoModal();
                };
                reader.readAsDataURL(logoFile);
            }
        });

        // Payment Methods Management
        function loadPaymentMethods() {
            const select = document.getElementById('paymentMethod');
            if (select) {
                select.innerHTML = '<option value="">Seleccionar m√©todo de pago</option>';
                paymentMethods.filter(method => method.active).forEach(method => {
                    select.innerHTML += `<option value="${method.name.toLowerCase()}">${method.emoji} ${method.name}</option>`;
                });
            }
        }

        function loadAdminPayments() {
            const list = document.getElementById('adminPaymentsList');
            
            list.innerHTML = paymentMethods.map(method => `
                <div class="bg-gray-700 p-4 rounded-lg flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="text-2xl">${method.emoji}</div>
                        <div>
                            <h4 class="font-semibold">${method.name}</h4>
                            <p class="text-gray-300 text-sm">${method.description}</p>
                            ${method.account ? `<p class="text-gray-400 text-xs">${method.account}</p>` : ''}
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button onclick="togglePaymentMethod(${method.id})" class="px-3 py-1 ${method.active ? 'bg-yellow-600 hover:bg-yellow-700' : 'bg-green-600 hover:bg-green-700'} rounded text-sm">
                            ${method.active ? 'üëÅÔ∏è Desactivar' : 'üëÅÔ∏è‚Äçüó®Ô∏è Activar'}
                        </button>
                        <button onclick="editPaymentMethod(${method.id})" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm">‚úèÔ∏è Editar</button>
                        <button onclick="deletePaymentMethod(${method.id})" class="px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm">üóëÔ∏è Eliminar</button>
                    </div>
                </div>
            `).join('');
        }

        function showAddPaymentMethod() {
            document.getElementById('addPaymentModal').style.display = 'block';
        }

        function closeAddPayment() {
            document.getElementById('addPaymentModal').style.display = 'none';
            document.getElementById('addPaymentForm').reset();
            
            // Reset form to add mode
            delete document.getElementById('addPaymentForm').dataset.editingId;
            document.querySelector('#addPaymentModal h3').textContent = 'üí≥ Agregar M√©todo de Pago';
            document.querySelector('#addPaymentForm button[type="submit"]').textContent = 'Agregar M√©todo ‚ú®';
        }

        function togglePaymentMethod(methodId) {
            const method = paymentMethods.find(m => m.id === methodId);
            if (method) {
                method.active = !method.active;
                loadAdminPayments();
                loadPaymentMethods();
            }
        }

        function editPaymentMethod(methodId) {
            const method = paymentMethods.find(m => m.id === methodId);
            if (!method) return;
            
            // Fill form with existing data
            document.getElementById('paymentName').value = method.name;
            document.getElementById('paymentEmoji').value = method.emoji;
            document.getElementById('paymentDescription').value = method.description;
            document.getElementById('paymentAccount').value = method.account || '';
            
            // Change form title and button
            document.querySelector('#addPaymentModal h3').textContent = '‚úèÔ∏è Editar M√©todo de Pago';
            document.querySelector('#addPaymentForm button[type="submit"]').textContent = 'Actualizar M√©todo ‚ú®';
            
            // Store editing method ID
            document.getElementById('addPaymentForm').dataset.editingId = methodId;
            
            document.getElementById('addPaymentModal').style.display = 'block';
        }

        function deletePaymentMethod(methodId) {
            const method = paymentMethods.find(m => m.id === methodId);
            if (!method) return;
            
            showConfirmModal(
                'üóëÔ∏è Eliminar M√©todo de Pago',
                `¬øEst√°s seguro de que quieres eliminar "${method.name}"? Esta acci√≥n no se puede deshacer.`,
                function() {
                    paymentMethods = paymentMethods.filter(m => m.id !== methodId);
                    loadAdminPayments();
                    loadPaymentMethods();
                }
            );
        }

        // Payment form submission
        document.getElementById('addPaymentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const editingId = this.dataset.editingId;
            const isEditing = !!editingId;
            
            const methodData = {
                id: isEditing ? parseInt(editingId) : Date.now(),
                name: document.getElementById('paymentName').value,
                emoji: document.getElementById('paymentEmoji').value || 'üí≥',
                description: document.getElementById('paymentDescription').value,
                account: document.getElementById('paymentAccount').value,
                active: true
            };
            
            if (isEditing) {
                const index = paymentMethods.findIndex(m => m.id === parseInt(editingId));
                if (index !== -1) {
                    // Keep existing active status
                    methodData.active = paymentMethods[index].active;
                    paymentMethods[index] = methodData;
                }
            } else {
                paymentMethods.push(methodData);
            }
            
            // Reset form
            delete document.getElementById('addPaymentForm').dataset.editingId;
            document.querySelector('#addPaymentModal h3').textContent = 'üí≥ Agregar M√©todo de Pago';
            document.querySelector('#addPaymentForm button[type="submit"]').textContent = 'Agregar M√©todo ‚ú®';
            
            closeAddPayment();
            loadAdminPayments();
            loadPaymentMethods();
        });

        // Category form submission
        document.getElementById('addCategoryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const editingKey = this.dataset.editingKey;
            const isEditing = !!editingKey;
            
            const categoryData = {
                key: document.getElementById('categoryKey').value.toLowerCase().replace(/\s+/g, '-'),
                name: document.getElementById('categoryName').value,
                emoji: document.getElementById('categoryEmoji').value || 'üìÇ',
                description: document.getElementById('categoryDescription').value
            };
            
            // Check if key already exists (only for new categories or if key changed)
            const existingCategory = categories.find(c => c.key === categoryData.key);
            if (existingCategory && (!isEditing || editingKey !== categoryData.key)) {
                alert('Ya existe una categor√≠a con esa clave. Por favor usa una clave diferente.');
                return;
            }
            
            if (isEditing) {
                const index = categories.findIndex(c => c.key === editingKey);
                if (index !== -1) {
                    // If key changed, update products that use this category
                    if (editingKey !== categoryData.key) {
                        products.forEach(product => {
                            if (product.category === editingKey) {
                                product.category = categoryData.key;
                            }
                        });
                    }
                    categories[index] = categoryData;
                }
            } else {
                categories.push(categoryData);
            }
            
            // Reset form
            delete document.getElementById('addCategoryForm').dataset.editingKey;
            document.querySelector('#addCategoryModal h3').textContent = 'üìÇ Agregar Categor√≠a';
            document.querySelector('#addCategoryForm button[type="submit"]').textContent = 'Agregar Categor√≠a ‚ú®';
            
            closeAddCategory();
            loadAdminCategories();
            updateCategorySelectors();
        });

        // Logo and Settings Management
        function loadAdminSettings() {
            // This function can be used to load saved settings if needed
        }

        function uploadHeaderLogo() {
            const logoFile = document.getElementById('headerLogoFile').files[0];
            
            if (!logoFile) {
                alert('Por favor selecciona un archivo de imagen');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const logoUrl = e.target.result;
                document.getElementById('logoContainer').innerHTML = `<img src="${logoUrl}" alt="LA MORENA SMOKESHOP" class="w-full h-full object-contain rounded-full">`;
                
                // Show preview
                document.getElementById('headerLogoImg').src = logoUrl;
                document.getElementById('headerLogoPreview').classList.remove('hidden');
                
                alert('Logo del header actualizado correctamente ‚úÖ');
            };
            reader.readAsDataURL(logoFile);
        }

        function uploadBackgroundLogo() {
            const logoFile = document.getElementById('backgroundLogoFile').files[0];
            const opacity = document.getElementById('backgroundOpacity').value;
            
            if (!logoFile) {
                alert('Por favor selecciona un archivo de imagen');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const logoUrl = e.target.result;
                
                // Create overlay div for background logo
                let overlay = document.getElementById('backgroundOverlay');
                if (!overlay) {
                    overlay = document.createElement('div');
                    overlay.id = 'backgroundOverlay';
                    overlay.style.position = 'fixed';
                    overlay.style.top = '0';
                    overlay.style.left = '0';
                    overlay.style.width = '100%';
                    overlay.style.height = '100%';
                    overlay.style.zIndex = '-1';
                    overlay.style.pointerEvents = 'none';
                    document.body.appendChild(overlay);
                }
                
                overlay.style.backgroundImage = `url(${logoUrl})`;
                overlay.style.backgroundSize = 'cover';
                overlay.style.backgroundPosition = 'center';
                overlay.style.backgroundRepeat = 'no-repeat';
                overlay.style.opacity = opacity;
                overlay.style.filter = 'blur(2px)';
                
                alert('Logo de fondo aplicado correctamente ‚úÖ');
            };
            reader.readAsDataURL(logoFile);
        }

        function removeBackgroundLogo() {
            const overlay = document.getElementById('backgroundOverlay');
            if (overlay) {
                overlay.remove();
                alert('Logo de fondo removido ‚úÖ');
            } else {
                alert('No hay logo de fondo para remover');
            }
        }

        function saveContactInfo() {
            const whatsapp = document.getElementById('whatsappNumber').value;
            const email = document.getElementById('businessEmail').value;
            const address = document.getElementById('businessAddress').value;
            
            // Update WhatsApp links
            if (whatsapp) {
                const whatsappLinks = document.querySelectorAll('a[href*="wa.me"]');
                whatsappLinks.forEach(link => {
                    const currentHref = link.getAttribute('href');
                    const newHref = currentHref.replace(/wa\.me\/\d+/, `wa.me/${whatsapp}`);
                    link.setAttribute('href', newHref);
                });
                
                // Update sendToWhatsApp function calls
                window.currentWhatsAppNumber = whatsapp;
            }
            
            alert('Informaci√≥n de contacto guardada correctamente ‚úÖ');
        }

        // Update sendToWhatsApp function to use dynamic number
        function sendToWhatsApp() {
            const form = document.getElementById('checkoutForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const whatsappNumber = window.currentWhatsAppNumber || '573150646191';

            const customerData = {
                name: document.getElementById('customerName').value,
                address: document.getElementById('customerAddress').value,
                neighborhood: document.getElementById('customerNeighborhood').value,
                phone: document.getElementById('customerPhone').value,
                email: document.getElementById('customerEmail').value,
                paymentMethod: document.getElementById('paymentMethod').value,
                items: cart,
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                date: new Date().toLocaleString()
            };

            // Guardar cliente en base de datos
            customers.push(customerData);

            // Crear mensaje para WhatsApp
            let message = `üõí *NUEVO PEDIDO - LA MORENA SMOKESHOP*\n\n`;
            message += `üë§ *Cliente:* ${customerData.name}\n`;
            message += `üìç *Direcci√≥n:* ${customerData.address}, ${customerData.neighborhood}\n`;
            message += `üì± *Tel√©fono:* ${customerData.phone}\n`;
            message += `üìß *Email:* ${customerData.email}\n`;
            message += `üí≥ *M√©todo de pago:* ${customerData.paymentMethod}\n\n`;
            message += `üõçÔ∏è *PRODUCTOS:*\n`;
            
            cart.forEach(item => {
                message += `‚Ä¢ ${item.name} x${item.quantity} - $${(item.price * item.quantity).toLocaleString('es-CO')}\n`;
            });
            
            message += `\nüí∞ *TOTAL: $${customerData.total.toLocaleString('es-CO')}*\n\n`;
            message += `üìÖ *Fecha:* ${customerData.date}`;

            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');

            // Limpiar carrito y cerrar modal
            cart = [];
            updateCartCount();
            closeCheckout();
            alert('¬°Pedido enviado! Te contactaremos pronto üòä');
        }

        // Update shareProduct function to use dynamic number
        function shareProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const whatsappNumber = window.currentWhatsAppNumber || '573150646191';

            const message = `üõçÔ∏è *${product.name}* - LA MORENA SMOKESHOP\n\n` +
                          `üí∞ Precio: $${product.price.toLocaleString('es-CO')}\n` +
                          `üìù ${product.description.substring(0, 200)}${product.description.length > 200 ? '...' : ''}\n\n` +
                          `¬°Pregunta por este producto! üíú`;

            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            
            // Mostrar confirmaci√≥n visual
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '‚úÖ Compartido';
            button.style.background = '#10b981';
            setTimeout(() => {
                button.innerHTML = originalText;
                button.style.background = '';
            }, 2000);
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9803f08ec709f78e',t:'MTc1ODA2MzIwMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
